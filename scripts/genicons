#!/usr/bin/env bash

set -euo pipefail

SCRIPT_DIR="$(cd -- "$(dirname -- "$(readlink -f -- "${BASH_SOURCE[0]}")")" && pwd)"
cd "${SCRIPT_DIR}/.."

ASSETS_DIR="XCodeWrapper/Assets.xcassets/AppIcon.appiconset"
ORIG_ICON="extern/assets/icons/app_icon_orig.png"

if [ ! -f $ORIG_ICON ]; then
    echo "Error: app_icon_orig.png not found in project"
    exit 1
fi

if ! command -v magick &> /dev/null; then
    echo "Error: ImageMagick not found. Install with: brew install imagemagick"
    exit 1
fi

echo "Generating app icons from app_icon_orig.png..."

SRGB_PROFILE="/System/Library/ColorSync/Profiles/sRGB Profile.icc"

magick "${ORIG_ICON}" -resize 1024x1024 -colorspace sRGB -profile "${SRGB_PROFILE}" "${ASSETS_DIR}/icon_1024x1024.png"

echo "Generated all app icon sizes"

# sudo rm -rf /Library/Caches/com.apple.iconservices.store
